# =============================================
# AMI LwM2M Node — Thread + LwM2M on ESP32-C6
# Aligned with working Windows build (no MCUboot)
# =============================================

# --- Core ---
CONFIG_LOG=y
CONFIG_LOG_BACKEND_UART=y
CONFIG_GPIO=y
CONFIG_PRINTK=y
CONFIG_CONSOLE=y
CONFIG_SERIAL=y
CONFIG_UART_CONSOLE=y
CONFIG_MAIN_STACK_SIZE=4096
CONFIG_SYSTEM_WORKQUEUE_STACK_SIZE=4096
CONFIG_HEAP_MEM_POOL_SIZE=65536
CONFIG_BOOT_DELAY=3000
CONFIG_REBOOT=y

# --- Networking ---
CONFIG_NETWORKING=y
CONFIG_NET_IPV6=y
CONFIG_NET_IPV4=n
CONFIG_NET_TCP=n
CONFIG_NET_UDP=y
CONFIG_NET_SOCKETS=y
CONFIG_NET_CONFIG_SETTINGS=y
CONFIG_NET_CONFIG_NEED_IPV6=y
CONFIG_NET_CONFIG_INIT_TIMEOUT=5
CONFIG_NET_CONFIG_NEED_IPV4=n
CONFIG_NET_CONFIG_MY_IPV4_ADDR=""
CONFIG_NET_CONFIG_PEER_IPV4_ADDR=""

# IPv6 buffer sizing
CONFIG_NET_IF_UNICAST_IPV6_ADDR_COUNT=6
CONFIG_NET_IF_MCAST_IPV6_ADDR_COUNT=8
CONFIG_NET_PKT_RX_COUNT=16
CONFIG_NET_PKT_TX_COUNT=16
CONFIG_NET_BUF_RX_COUNT=32
CONFIG_NET_BUF_TX_COUNT=32
CONFIG_NET_MAX_CONTEXTS=6

CONFIG_NET_IPV6_NBR_CACHE=n
CONFIG_NET_IPV6_MLD=n

# --- OpenThread ---
CONFIG_NET_L2_OPENTHREAD=y
CONFIG_OPENTHREAD_THREAD_VERSION_1_4=y
CONFIG_OPENTHREAD_FTD=y

# Thread Network Credentials (must match OTBR)
CONFIG_OPENTHREAD_CHANNEL=25
CONFIG_OPENTHREAD_PANID=43981
CONFIG_OPENTHREAD_NETWORKKEY="00:11:22:33:44:55:66:77:88:99:aa:bb:cc:dd:ee:ff"
CONFIG_OPENTHREAD_NETWORK_NAME="AMI-Pilot-2025"
CONFIG_OPENTHREAD_XPANID="12:34:56:78:90:ab:cd:ef"

# OpenThread features
CONFIG_OPENTHREAD_SRP_CLIENT=y
CONFIG_OPENTHREAD_DNS_CLIENT=y
CONFIG_OPENTHREAD_SLAAC=y
CONFIG_OPENTHREAD_DHCP6_CLIENT=y
CONFIG_OPENTHREAD_SNTP_CLIENT=y
CONFIG_OPENTHREAD_SHELL=y
CONFIG_OPENTHREAD_COMMISSIONER=y

# OpenThread debug
CONFIG_OPENTHREAD_DEBUG=y
CONFIG_OPENTHREAD_L2_DEBUG=y
CONFIG_OPENTHREAD_L2_LOG_LEVEL_INF=y

# --- NVS for OpenThread credentials persistence ---
CONFIG_NVS=y
CONFIG_FLASH=y
CONFIG_FLASH_MAP=y
CONFIG_SETTINGS=y
CONFIG_SETTINGS_NVS=y
CONFIG_OPENTHREAD_SETTINGS_RAM=n

# --- Shell (for debug) ---
CONFIG_SHELL=y
CONFIG_SHELL_STACK_SIZE=3072
CONFIG_OPENTHREAD_SHELL=y

# --- LwM2M ---
CONFIG_LWM2M=y
CONFIG_LWM2M_LOG_LEVEL_DBG=y
CONFIG_LWM2M_COAP_BLOCK_SIZE=512
CONFIG_LWM2M_ENGINE_MAX_OBSERVER=32
CONFIG_LWM2M_ENGINE_MAX_MESSAGES=12
CONFIG_LWM2M_ENGINE_MAX_PENDING=12
CONFIG_LWM2M_ENGINE_MAX_REPLIES=12
CONFIG_LWM2M_RD_CLIENT_MAX_RETRIES=10
CONFIG_LWM2M_ENGINE_STACK_SIZE=8192
CONFIG_LWM2M_SHELL=y

# Custom Object 10242 (3-Phase Power Meter) — no IPSO needed

# Object 4 (Connectivity Monitoring) — populated with Thread data
CONFIG_LWM2M_CONN_MON_OBJ_SUPPORT=y
CONFIG_LWM2M_CONNMON_OBJECT_VERSION_1_0=y
CONFIG_LWM2M_CONN_MON_BEARER_MAX=1

# LwM2M Server address — OTBR's mesh-local EID (Leshan runs there)
CONFIG_NET_CONFIG_PEER_IPV6_ADDR="fdc6:63fd:328d:66df:6a54:12ef:8c67:bd1c"

# CoAP
CONFIG_COAP_EXTENDED_OPTIONS_LEN=y
CONFIG_COAP_EXTENDED_OPTIONS_LEN_VALUE=40

# --- mbedTLS (required by OpenThread) ---
CONFIG_MBEDTLS_SSL_MAX_CONTENT_LEN=768

# --- ESP32-C6 specific ---
CONFIG_WIFI=n
CONFIG_BT=n
CONFIG_SERIAL_ESP32_USB=y
CONFIG_UART_INTERRUPT_DRIVEN=y

# --- Entropy ---
CONFIG_ENTROPY_GENERATOR=y

# --- Debug extras ---
CONFIG_EXCEPTION_STACK_TRACE=y
CONFIG_FAULT_DUMP=2
CONFIG_EXTRA_EXCEPTION_INFO=y
CONFIG_IEEE802154_DRIVER_LOG_LEVEL_WRN=y
CONFIG_NET_LOG=y
CONFIG_OPENTHREAD_L2_LOG_LEVEL_INF=y

# --- Floating point printf ---
CONFIG_CBPRINTF_FP_SUPPORT=y
